<!DOCTYPE html>
<div>The last <input id="digit-input" type="number" value="100"> digits of Graham's Number, <span id="calculation_status"></span> directly in your browser<span id="timespan"></span>:</div>
<div id="number-container"></div>
<style>
    #digit-input {
        max-width: 3em;
        text-align: center;
        appearance: textfield;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    #number-container {
        overflow-wrap: anywhere;
    }
</style>
<script id="graham_worker">
    self.onmessage = (message) => {
        let start_time = Date.now();

        let digits_count = BigInt(message.data);
        let number = graham_number(digits_count);
        let time_elapsed_seconds = (Date.now() - start_time) / 1000;
        self.postMessage({
            number,
            time_elapsed_seconds,
        });
    }

    function pow_mod(exponent, mod, base) {
        let working_exponent = exponent % (mod * 2n / 5n);
        let working_base = base;
        let result = 1n;

        while (working_exponent > 0n) {
            if (working_exponent % 2n == 1n) {
                result = result * working_base % mod;
            }
            working_base = working_base * working_base % mod;
            working_exponent = working_exponent / 2n;
        }

        return result;
    }

    function graham_number(digits_count) {
        let result = 3n;
        for (let i = 1n; i < digits_count + 1n; i++) {
            result = pow_mod(result, 10n ** i, 3n);
        }
        return result;
    }
</script>
<script>
    const GRAHAM_WORKER_BLOB = new Blob([document.querySelector("#graham_worker").textContent], {type: "text/javascript"});
    const GRAHAM_WORKER = new Worker(window.URL.createObjectURL(GRAHAM_WORKER_BLOB));
    GRAHAM_WORKER.onmessage = (message) => {
        update_display("calculated", message.data.time_elapsed_seconds, message.data.number);
    }

    function recalculate(digits_count) {
        GRAHAM_WORKER.postMessage(digits_count);
    }

    function update_display(calculation_status = "calculating", timespan = "", number = "") {
        document.querySelector("#calculation_status").textContent = calculation_status;
        document.querySelector("#timespan").textContent = timespan ? " in " + timespan + "s" : "";
        document.querySelector("#number-container").textContent = number;
    }

    document.querySelector("#digit-input").addEventListener("change", (e) => {
        let digits_count = e.target.value;
        recalculate(digits_count);
        update_display();
    });

    recalculate(100n);
    update_display();
</script>
